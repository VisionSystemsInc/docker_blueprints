x-args:
  gdal: &gdal_args
    GDAL_VERSION: "3.10.3"
    NUMPY_VERSION: &gdal_numpy_version "2.1.3"
    PYTHON_VERSION: &gdal_python_version "3.10.18"
  pdal: &pdal_args
    PDAL_VERSION: "2.8.3"
    PDAL_PYTHON_VERSION: "3.4.5"
    NUMPY_VERSION: *gdal_numpy_version
    PYTHON_VERSION: *gdal_python_version
  nglog: &nglog_args
    NGLOG_VERSION: "v0.8.0"
    LIBUNWIND_VERSION: "v1.8.2"
    PYTHON_VERSION: &nglog_python_version "3.9"
  s2: &s2_args
    S2GEOMETRY_VERSION: "v0.11.1"
    ABSEIL_VERSION: "20240722.0"
    PYTHON_VERSION: &s2_python_version "3.10.15"
  tinycudann: &tinycudann_args
    CUDA_VERSION: &tinycudann_cuda_version "11.8.0"
    PYTHON_VERSION: &tinycudann_python_version "3.10.15"
    TINYCUDANN_VERSION: "c91138bcd4c6877c8d5e60e483c0581aafc70cce"
    TCNN_CUDA_ARCHITECTURES: "70,86"
    TORCH_VERSION: &tinycudann_torch_version "2.1.2+cu118"

services:

  gdal:
    build:
      context: ..
      dockerfile: blueprint_gdal.Dockerfile
      args:
        <<: *gdal_args
    image: &gdal_image vsiri/blueprint_test:gdal

  pdal:
    build:
      context: ..
      dockerfile: blueprint_pdal.Dockerfile
      args:
        GDAL_IMAGE: *gdal_image
        <<: *pdal_args
    image: &pdal_image vsiri/blueprint_test:pdal

  s2:
    build:
      context: ..
      dockerfile: blueprint_s2geometry.Dockerfile
      args:
        <<: *s2_args
    image: &s2_image vsiri/blueprint_test:s2

  nglog:
    build:
      context: ..
      dockerfile: blueprint_nglog.Dockerfile
      args:
        <<: *nglog_args
    image: &nglog_image vsiri/blueprint_test:nglog

  tinycudann:
    build:
      context: ..
      dockerfile: blueprint_tinycudann.Dockerfile
      args:
        <<: *tinycudann_args
    image: &tinycudann_image vsiri/blueprint_test:tinycudann

  test_gdal:
    build:
      context: .
      dockerfile: test_gdal.Dockerfile
      args:
        GDAL_IMAGE: *gdal_image
        PYTHON_VERSION: *gdal_python_version
        NUMPY_VERSION: *gdal_numpy_version
    image: vsiri/blueprint_test:test_gdal

  test_pdal:
    build:
      context: .
      dockerfile: test_pdal.Dockerfile
      args:
        GDAL_IMAGE: *gdal_image
        PDAL_IMAGE: *pdal_image
        PYTHON_VERSION: *gdal_python_version
        NUMPY_VERSION: *gdal_numpy_version
    image: vsiri/blueprint_test:test_pdal

  test_s2:
    build:
      context: .
      dockerfile: test_s2geometry.Dockerfile
      args:
        S2_IMAGE: *s2_image
        PYTHON_VERSION: *s2_python_version
    image: vsiri/blueprint_test:test_s2

  test_nglog:
    build:
      context: .
      dockerfile: test_nglog.Dockerfile
      args:
        NGLOG_IMAGE: *nglog_image
        PYTHON_VERSION: *nglog_python_version
    image: vsiri/blueprint_test:test_nglog

  test_tinycudann:
    build:
      context: .
      dockerfile: test_tinycudann.Dockerfile
      args:
        TINYCUDANN_IMAGE: *tinycudann_image
        CUDA_VERSION: *tinycudann_cuda_version
        PYTHON_VERSION: *tinycudann_python_version
        TORCH_VERSION: *tinycudann_torch_version
    image: vsiri/blueprint_test:test_tinycudann

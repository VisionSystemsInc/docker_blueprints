version: '2.3'

services:

  gdal_3_2_3:
    build:
      context: ..
      dockerfile: blueprint_gdal.Dockerfile
      cache_from:
        - vsiri/blueprint:gdal
      args:
        GDAL_VERSION: "3.2.3"
    image: &gdal_image vsiri/test_blueprint:gdal-3.2.3

  pdal_2_2_0:
    build:
      context: ..
      dockerfile: blueprint_pdal.Dockerfile
      cache_from:
        - vsiri/blueprint:pdal
      args:
        GDAL_IMAGE: *gdal_image
        PDAL_VERSION: "2.2.0"
    image: &pdal_image vsiri/test_blueprint:pdal-2.2.0

  # test_gdal:
  #   build:
  #     context: .
  #     dockerfile: test_gdal.Dockerfile
  #     args:
  #       GDAL_IMAGE: *gdal_image
  #   image: vsiri/test_blueprint:test_gdal

  # test_pdal:
  #   build:
  #     context: .
  #     dockerfile: test_pdal.Dockerfile
  #   args:
  #     GDAL_IMAGE: *gdal_image
  #     PDAL_IMAGE: *pdal_image
  #   image: vsiri/test_blueprint:test_pdal
